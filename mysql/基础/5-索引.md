# MySQL索引

标签（空格分隔）： MySQL

---

> 所有MySQL列类型都可以被索引，对相关列使用索引是提高select操作性能的最佳途径。根据存储引擎可以定义每个表的最大索引数和最大索引长度，每种存储引擎对每个表至少支持16个索引，总索引长度至少为256字节。

> MyISAM和InnoDB存储引擎的表默认创建的都是BTREE索引。支持前缀索引，前缀索引的长度跟存储引擎相关，对于MyISAM存储引擎的表，索引的前缀长度可以达到1000字节长。而对于InnoDB存储引擎的表，索引的前缀长度最长是767字节。

> MySQL还支持全文本（fulltext）索引，该索引可以用于全文搜索。

> 也可以为空间列类型创建索引，但只有MyISAM存储引擎支持空间类型索引，且索引的字段必须是非空的。

> 默认情况下，MEMORY存储引擎使用HASH索引，但也支持BTREE索引。

> 创建索引

<pre>
create [unique|fulltext|spatial] 
  index index_name
  [using index_type]
  on table_name(index_col_name,...)
  --index_col_name:col_name[(length)][ASC|DESC]--
</pre>

> 删除索引
`drop index index_name on table_name`

### 1 设计原则

> 索引的设计可以遵循一些已有的原则，创建索引的时候请尽量考虑符合这些原则，便于提升索引的使用效率，更高效地使用索引。

> 1 - 搜索的索引列，不一定是所要选择的列。换句话说，最适合索引的列是出现在**where子句中的列** ， 或**链接子句中指定的列** ， 而不是出现在select关键字后的列。

> 2- 使用唯一索引。考虑某列中值的分布。索引的列的基数越大，索引的效果越好。例如，存放出生日期的列具有不同值，很容易区分各行。而用来记录性别的列，只含有“M”和“F”，则对此列进行索引没有多大用处，因为不管搜索哪个值，都会得出大约一半的行。

> 3- 使用短索引。如果对字符串列进行索引，应该指定一个前缀长度，只要有可能就应该这样做。例如，有一个char（200）列，如果在前10个或20个字符进行索引能够节省大量索引空间，也可能会使查询更快。**较小的索引涉及的磁盘IO较少，较短的值比较起来更快。更为重要的是，对于较短的键值，索引高速缓存中的块能够容纳更多的键值**，因此，MySQL也可以在内存中容纳更多的值。这样就增加了找到行而不用读取索引中较多块的可能性。

> 4- 利用最左前缀。在创建一个n列的索引时，实际是创建了MySQL可利用的n个索引。多列索引可起几个索引的作用，因为可利用索引中最左边的列集来匹配行。这样的列集称为最左前缀。

> 5- 不要过度索引。不要以为索引“越多越好”，什么东西都用索引是错误的。**每个额外的索引都要占用额外的磁盘空间，并降低写操作的性能**。在修改表内容时，索引必须进行更新，有时可能需要重构， 因此，索引越多，所花的时间越长。如果有一个索引很少利用或从不使用，那么会不必要地减缓表的修改速度。此外，MySQL在生成一个执行计划时，要考虑各个索引，这也要花费时间。创建多余的索引给查询优化带来了更多的工作。索引太多，也可能会使MySQL选择不到所要使用的最好索引。值保持所需的索引有利于查询优化。

> 6- 对于InnoDB存储引擎的表，记录默认会按照一定的顺序保存，**如果有明确定义的主键，则按照主键顺序保存。如果没有主键，但是有唯一索引，那么就是按照唯一索引的顺序保存。如果既没有主键又没有唯一索引，那么表中会自动生成一个内部列，按照这个列的顺序保存**。按照主键或者内部列进行的访问时最快的，所以InnoDB表尽量自己制定主键，当表中同时又几个列都是唯一的，都可以作为主键的时候，要选择最常作为访问条件的列作为主键，提高查询的效率。另外，还需要注意，InnoDB表的普通索引都会保存主键的键值，所以主键要尽可能选择较短的数据类型，可以有效地减少索引的磁盘占用，提高索引的缓存效果。

### 2 BTREE索引与HASH索引

> MEMORY存储引起的表可以选择使用BTREE索引或者HASH索引，两种不同类型的索引各有其不同的使用范围。HASH索引有一些重要的特征需要在使用的时候特别注意，

> 1- 只用于使用=或<=>操作符的等式比较
> 2- 优化器不能使用HASH索引来加速order by操作。
> 3- MySQL不能确定在两个值之间大约有多少行。如果将一个MyISAM表改为HASH索引的MEMORY表，会影响一些查询的执行效率。
> 4- 只能使用整个关键字来搜索一行。

> 而对于BTREE索引，当使用>、<、>=、<=、between、!=或者<>，或者LIKE 'pattern'(pattern不以通配符开始)操作符时，都可以使用相关列上的索引。

> 下列范围查询适用于BTREEN索引和HASH索引:

> `select * from t1 where col1 = 1 or col1 in(15,18,20);`

> 下列范围查询只适用于BTREE索引：
<pre>
select * from t1 where col1 > 1 and col1 < 10;
select * from t1 where col1 like 'ab%' or col1 between 'lisa' and 'simon';
</pre>

> 当使用MEMORY表时，如果是默认创建的HASH索引，就要注意SQL语句的编写，确保可以使用上索引，如果一定要使用范围查询，那么在创建索引时，就应该学则创建成BTREE索引。

> 大多数MySQL索引（如pk，unique，index，fulltext等）在BTREE中存储。只是空间列类型的索引使用RTREE，MEMORY表还支持HASH索引。
